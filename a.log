RDMA通信性能测试程序
测试三种延迟模型下的RDMA通信速率和并发性能
===============================================

【测试1】不同消息大小的吞吐量测试
===============================================

--- 设备内存直接访问 ---
开始吞吐量测试: 消息大小=64 bytes, 迭代次数=1000

=== 设备内存-64B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 147422 ns
平均延迟: 147 ns (0.15 μs)
最小延迟: 140 ns
最大延迟: 1955 ns
P50延迟: 144 ns
P95延迟: 149 ns
P99延迟: 155 ns

--- 通信速率统计 ---
QPS (每秒查询数): 4423428.25
吞吐量: 269.98 MB/s
总传输字节: 64000 bytes

开始吞吐量测试: 消息大小=256 bytes, 迭代次数=1000

=== 设备内存-256B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 133041 ns
平均延迟: 133 ns (0.13 μs)
最小延迟: 109 ns
最大延迟: 513 ns
P50延迟: 147 ns
P95延迟: 149 ns
P99延迟: 151 ns

--- 通信速率统计 ---
QPS (每秒查询数): 5532625.89
吞吐量: 1350.74 MB/s
总传输字节: 256000 bytes

开始吞吐量测试: 消息大小=1024 bytes, 迭代次数=1000

=== 设备内存-1024B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 111182 ns
平均延迟: 111 ns (0.11 μs)
最小延迟: 109 ns
最大延迟: 350 ns
P50延迟: 111 ns
P95延迟: 112 ns
P99延迟: 115 ns

--- 通信速率统计 ---
QPS (每秒查询数): 5442798.90
吞吐量: 5315.23 MB/s
总传输字节: 1024000 bytes

开始吞吐量测试: 消息大小=4096 bytes, 迭代次数=1000

=== 设备内存-4096B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 152069 ns
平均延迟: 152 ns (0.15 μs)
最小延迟: 146 ns
最大延迟: 1292 ns
P50延迟: 148 ns
P95延迟: 174 ns
P99延迟: 175 ns

--- 通信速率统计 ---
QPS (每秒查询数): 3053593.62
吞吐量: 11928.10 MB/s
总传输字节: 4096000 bytes

开始吞吐量测试: 消息大小=16384 bytes, 迭代次数=1000

=== 设备内存-16384B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 99722 ns
平均延迟: 99 ns (0.10 μs)
最小延迟: 98 ns
最大延迟: 427 ns
P50延迟: 99 ns
P95延迟: 100 ns
P99延迟: 102 ns

--- 通信速率统计 ---
QPS (每秒查询数): 2409499.21
吞吐量: 37648.43 MB/s
总传输字节: 16384000 bytes


--- 中间缓存访问 ---
开始吞吐量测试: 消息大小=64 bytes, 迭代次数=1000

=== 中间缓存-64B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 69099077 ns
平均延迟: 69099 ns (69.10 μs)
最小延迟: 24574 ns
最大延迟: 312508 ns
P50延迟: 64323 ns
P95延迟: 84867 ns
P99延迟: 108475 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14442.92
吞吐量: 0.88 MB/s
总传输字节: 64000 bytes

开始吞吐量测试: 消息大小=256 bytes, 迭代次数=1000

=== 中间缓存-256B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 66758579 ns
平均延迟: 66758 ns (66.76 μs)
最小延迟: 61926 ns
最大延迟: 162558 ns
P50延迟: 63768 ns
P95延迟: 82690 ns
P99延迟: 112983 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14946.81
吞吐量: 3.65 MB/s
总传输字节: 256000 bytes

开始吞吐量测试: 消息大小=1024 bytes, 迭代次数=1000

=== 中间缓存-1024B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 68133490 ns
平均延迟: 68133 ns (68.13 μs)
最小延迟: 22588 ns
最大延迟: 176318 ns
P50延迟: 64375 ns
P95延迟: 86815 ns
P99延迟: 126450 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14640.67
吞吐量: 14.30 MB/s
总传输字节: 1024000 bytes

开始吞吐量测试: 消息大小=4096 bytes, 迭代次数=1000

=== 中间缓存-4096B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 72417838 ns
平均延迟: 72417 ns (72.42 μs)
最小延迟: 39670 ns
最大延迟: 436378 ns
P50延迟: 65143 ns
P95延迟: 94279 ns
P99延迟: 127036 ns

--- 通信速率统计 ---
QPS (每秒查询数): 13731.69
吞吐量: 53.64 MB/s
总传输字节: 4096000 bytes

开始吞吐量测试: 消息大小=16384 bytes, 迭代次数=1000

=== 中间缓存-16384B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 70742885 ns
平均延迟: 70742 ns (70.74 μs)
最小延迟: 62527 ns
最大延迟: 206726 ns
P50延迟: 65097 ns
P95延迟: 90438 ns
P99延迟: 127936 ns

--- 通信速率统计 ---
QPS (每秒查询数): 13977.58
吞吐量: 218.40 MB/s
总传输字节: 16384000 bytes


--- 主机交换访问 ---
开始吞吐量测试: 消息大小=64 bytes, 迭代次数=1000

=== 主机交换-64B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 151067323 ns
平均延迟: 151067 ns (151.07 μs)
最小延迟: 139336 ns
最大延迟: 288218 ns
P50延迟: 143260 ns
P95延迟: 189098 ns
P99延迟: 226375 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6608.66
吞吐量: 0.40 MB/s
总传输字节: 64000 bytes

开始吞吐量测试: 消息大小=256 bytes, 迭代次数=1000

=== 主机交换-256B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 160715016 ns
平均延迟: 160715 ns (160.72 μs)
最小延迟: 128499 ns
最大延迟: 360386 ns
P50延迟: 152293 ns
P95延迟: 213483 ns
P99延迟: 271367 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6209.27
吞吐量: 1.52 MB/s
总传输字节: 256000 bytes

开始吞吐量测试: 消息大小=1024 bytes, 迭代次数=1000

=== 主机交换-1024B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 151796612 ns
平均延迟: 151796 ns (151.80 μs)
最小延迟: 91462 ns
最大延迟: 326549 ns
P50延迟: 143916 ns
P95延迟: 188183 ns
P99延迟: 230423 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6574.76
吞吐量: 6.42 MB/s
总传输字节: 1024000 bytes

开始吞吐量测试: 消息大小=4096 bytes, 迭代次数=1000

=== 主机交换-4096B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 149310144 ns
平均延迟: 149310 ns (149.31 μs)
最小延迟: 136974 ns
最大延迟: 294509 ns
P50延迟: 142814 ns
P95延迟: 187619 ns
P99延迟: 218121 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6679.58
吞吐量: 26.09 MB/s
总传输字节: 4096000 bytes

开始吞吐量测试: 消息大小=16384 bytes, 迭代次数=1000

=== 主机交换-16384B 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 149951214 ns
平均延迟: 149951 ns (149.95 μs)
最小延迟: 98887 ns
最大延迟: 314354 ns
P50延迟: 143001 ns
P95延迟: 190142 ns
P99延迟: 227267 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6636.53
吞吐量: 103.70 MB/s
总传输字节: 16384000 bytes


【测试2】并发连接性能测试
===============================================

--- 设备内存并发测试 ---
开始并发吞吐量测试: 连接数=1, 消息大小=23 bytes, 每连接迭代=1000

=== 设备内存-1连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 99991 ns
平均延迟: 99 ns (0.10 μs)
最小延迟: 98 ns
最大延迟: 588 ns
P50延迟: 99 ns
P95延迟: 101 ns
P99延迟: 103 ns

--- 通信速率统计 ---
QPS (每秒查询数): 7609481.41
吞吐量: 166.91 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=5, 消息大小=23 bytes, 每连接迭代=200

=== 设备内存-5连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 100191 ns
平均延迟: 100 ns (0.10 μs)
最小延迟: 98 ns
最大延迟: 372 ns
P50延迟: 100 ns
P95延迟: 101 ns
P99延迟: 103 ns

--- 通信速率统计 ---
QPS (每秒查询数): 7483293.55
吞吐量: 164.14 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=10, 消息大小=23 bytes, 每连接迭代=100

=== 设备内存-10连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 100805 ns
平均延迟: 100 ns (0.10 μs)
最小延迟: 97 ns
最大延迟: 452 ns
P50延迟: 100 ns
P95延迟: 101 ns
P99延迟: 144 ns

--- 通信速率统计 ---
QPS (每秒查询数): 7455120.18
吞吐量: 163.52 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=20, 消息大小=23 bytes, 每连接迭代=50

=== 设备内存-20连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 197963 ns
平均延迟: 197 ns (0.20 μs)
最小延迟: 98 ns
最大延迟: 93513 ns
P50延迟: 100 ns
P95延迟: 120 ns
P99延迟: 191 ns

--- 通信速率统计 ---
QPS (每秒查询数): 4316093.42
吞吐量: 94.67 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=50, 消息大小=23 bytes, 每连接迭代=20

=== 设备内存-50连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 146784 ns
平均延迟: 146 ns (0.15 μs)
最小延迟: 98 ns
最大延迟: 1560 ns
P50延迟: 133 ns
P95延迟: 209 ns
P99延迟: 349 ns

--- 通信速率统计 ---
QPS (每秒查询数): 5310251.44
吞吐量: 116.48 MB/s
总传输字节: 23000 bytes


--- 中间缓存并发测试 ---
开始并发吞吐量测试: 连接数=1, 消息大小=23 bytes, 每连接迭代=1000

=== 中间缓存-1连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 66942683 ns
平均延迟: 66942 ns (66.94 μs)
最小延迟: 17891 ns
最大延迟: 173266 ns
P50延迟: 63650 ns
P95延迟: 86424 ns
P99延迟: 112631 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14915.84
吞吐量: 0.33 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=5, 消息大小=23 bytes, 每连接迭代=200

=== 中间缓存-5连接 性能统计 ===
成功率: 200/1000 (20.00%)
总耗时: 13974589 ns
平均延迟: 69872 ns (69.87 μs)
最小延迟: 63390 ns
最大延迟: 139524 ns
P50延迟: 64122 ns
P95延迟: 94764 ns
P99延迟: 128361 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14193.69
吞吐量: 0.31 MB/s
总传输字节: 4600 bytes

开始并发吞吐量测试: 连接数=10, 消息大小=23 bytes, 每连接迭代=100

=== 中间缓存-10连接 性能统计 ===
成功率: 100/1000 (10.00%)
总耗时: 6578390 ns
平均延迟: 65783 ns (65.78 μs)
最小延迟: 63219 ns
最大延迟: 106002 ns
P50延迟: 63589 ns
P95延迟: 81018 ns
P99延迟: 106002 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14992.56
吞吐量: 0.33 MB/s
总传输字节: 2300 bytes

开始并发吞吐量测试: 连接数=20, 消息大小=23 bytes, 每连接迭代=50

=== 中间缓存-20连接 性能统计 ===
成功率: 50/1000 (5.00%)
总耗时: 3286829 ns
平均延迟: 65736 ns (65.74 μs)
最小延迟: 63659 ns
最大延迟: 101262 ns
P50延迟: 64081 ns
P95延迟: 73346 ns
P99延迟: 101262 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14858.72
吞吐量: 0.33 MB/s
总传输字节: 1150 bytes

开始并发吞吐量测试: 连接数=50, 消息大小=23 bytes, 每连接迭代=20

=== 中间缓存-50连接 性能统计 ===
成功率: 20/1000 (2.00%)
总耗时: 1270884 ns
平均延迟: 63544 ns (63.54 μs)
最小延迟: 63319 ns
最大延迟: 64414 ns
P50延迟: 63485 ns
P95延迟: 64414 ns
P99延迟: 64414 ns

--- 通信速率统计 ---
QPS (每秒查询数): 14972.79
吞吐量: 0.33 MB/s
总传输字节: 460 bytes


--- 主机交换并发测试 ---
开始并发吞吐量测试: 连接数=1, 消息大小=23 bytes, 每连接迭代=1000

=== 主机交换-1连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 155902124 ns
平均延迟: 155902 ns (155.90 μs)
最小延迟: 134023 ns
最大延迟: 503899 ns
P50延迟: 144238 ns
P95延迟: 201057 ns
P99延迟: 246698 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6404.94
吞吐量: 0.14 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=5, 消息大小=23 bytes, 每连接迭代=200

=== 主机交换-5连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 154147862 ns
平均延迟: 154147 ns (154.15 μs)
最小延迟: 114226 ns
最大延迟: 468964 ns
P50延迟: 144343 ns
P95延迟: 192858 ns
P99延迟: 236188 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6478.11
吞吐量: 0.14 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=10, 消息大小=23 bytes, 每连接迭代=100

=== 主机交换-10连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 155644987 ns
平均延迟: 155644 ns (155.64 μs)
最小延迟: 114466 ns
最大延迟: 388281 ns
P50延迟: 145271 ns
P95延迟: 196331 ns
P99延迟: 234126 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6413.95
吞吐量: 0.14 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=20, 消息大小=23 bytes, 每连接迭代=50

=== 主机交换-20连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 152223102 ns
平均延迟: 152223 ns (152.22 μs)
最小延迟: 127048 ns
最大延迟: 281176 ns
P50延迟: 143264 ns
P95延迟: 192023 ns
P99延迟: 241265 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6560.77
吞吐量: 0.14 MB/s
总传输字节: 23000 bytes

开始并发吞吐量测试: 连接数=50, 消息大小=23 bytes, 每连接迭代=20

=== 主机交换-50连接 性能统计 ===
成功率: 1000/1000 (100.00%)
总耗时: 150139497 ns
平均延迟: 150139 ns (150.14 μs)
最小延迟: 135208 ns
最大延迟: 341277 ns
P50延迟: 143320 ns
P95延迟: 185433 ns
P99延迟: 222576 ns

--- 通信速率统计 ---
QPS (每秒查询数): 6652.11
吞吐量: 0.15 MB/s
总传输字节: 23000 bytes


===============================================
并发性能对比分析
===============================================
测试场景        QPS         吞吐量(MB/s)平均延迟(μs)成功率(%)
---------------------------------------------------------------------------
设备内存-1连接7609481.4   166.91         0.10        100.0     
设备内存-5连接7483293.5   164.14         0.10        100.0     
设备内存-10连接7455120.2   163.52         0.10        100.0     
设备内存-20连接4316093.4   94.67          0.20        100.0     
设备内存-50连接5310251.4   116.48         0.15        100.0     

测试完成！
